<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>JavaScript Browser Bits</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="lib/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="lib/reveal.js/css/theme/black.css">
    <link rel="stylesheet" href="lib/reveal.js/lib/css/zenburn.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <div class="reveal">
      <div class="slides">
        <section data-background="#fff">
          <h1>JavaScript <br />Browser Bits</h1>
          <h3>@BenjaminBenBen</h3>
        </section>

        <section>
          <section data-background="#eee">
            <h2>I'm Ben</h2>
          </section>
          <section>
            <h2>Freelance developer</h2>
            <h4>based in Oxford</h4>
          </section>
          <section>
            <h4>[relevant stuff]</h4>
          </section>
        </section>

        <section>
          <section>
            <h2>We're going to cover a lot</h2>
          </section>
          <!--section>
            <h4>1. <span class="fragment">Struggle to learn something</span>
            </h4>
            <h4>2. <span class="fragment">Work it out</span>
            </h4>
            <h4>3. <span class="fragment">Assume everyone else knew it already</span>
            </h4>
          </section-->
        </section>

        <section>
          <section data-background="#fff">
            <h1>Bits</h1>
          </section>

          <section>
            <h2>[hands]</h2>
            <h4>Decimal (base 10)</h4>
          </section>

          <section>
            <h2>[microchip]</h2>
            <h4>Binary (base 2)</h4>
          </section>

          <!-- <section id="count-dec">
            <h3>Base 10</h3>
            <h1 class="output-dec mono" style="text-align:right">-</h1>

            <h3>Base 2</h3>
            <h1 class="output-bin mono" style="text-align:right">-</h1>
          </section> -->

          <section class="frag-collapse">

            <h3>Base 10</h3>
            <h3 class="output-dec mono" style="text-align:right">42</h3>

            <h3>Base 2</h3>
            <h3 class="output-bin mono" style="text-align:right">00101010</h3>

            <h3>Base 8</h3>
            <h3 class="output-oct mono" style="text-align:right">52</h3>

            <h3>Base 16</h3>
            <h3 class="output-hex mono" style="text-align:right">2a</h3>
          </section>

          <section>
            <h3>How to JavaScript</h3>
          </section>


          <section>
            <h3>Outputting</h3>
            <h1><pre><code data-trim class="hljs javascript">
              (42).toString(10) == '42'
              (42).toString(2)  == '101010'
              (42).toString(8)  == '52'
              (42).toString(16) == '2a'
            </code></pre></h1>
          </section>

          <section>
            <h3>Parsing</h3>
            <h1><pre><code data-trim class="hljs javascript">
              42 == parseInt('42',     10)
              42 == parseInt('101010', 2)
              42 == parseInt('52',     8)
              42 == parseInt('2a',     16)
            </code></pre></h1>
          </section>

          <section>
            <h3>Integer Literals</h3>
            <h1><pre><code data-trim class="hljs javascript">
              42 == 42
              42 == 0b101010 //*es6
              42 == 0o52
              42 == 0x2a
            </code></pre></h1>
          </section>


          <section>
            <h1>What can we do now?</h1>
          </section>

          <section>
            <h2>Numbers are numbers</h2>
            <h1><pre><code data-trim class="hljs javascript">
              Math.sqrt(
                Math.pow(3, 0b10) +
                Math.pow(0o4, 0x2)
              )
            </code></pre></h1>
          </section>

          <section>
            <h2>But also, other stuff.</h2>
            <h1 class="fragment">OR, AND, NOT, …</h1>
          </section>

          <section>
            <h1><pre><code data-trim class="hljs javascript" data-noescape>
                    011<span class="fragment">00101010101</span>
                AND 101<span class="fragment">10001010111</span>

                =   001<span class="fragment">00001010101</span>
            </code></pre></h1>
          </section>

          <section>
            <h1>Bitwise operators</h1>
            <h1>&amp; | ~ << >></h1>
          </section>

          <section>
            <h1 class="head-up">&amp; (AND)</h1>
            <h1><pre><code data-trim class="hljs javascript">
                 0b0000000011111111
              &amp;  0b0000111111110000

              == 0b0000000011110000
            </code></pre></h1>
          </section>

          <section>
            <h1 class="head-up">| (OR)</h1>
            <h1><pre><code data-trim class="hljs javascript">
                 0b0000000011111111
              |  0b0000111111110000

              == 0b0000111111111111
            </code></pre></h1>
          </section>


          <section>
            <h1 class="head-up">~ (NOT)</h1>
            <h1><pre><code data-trim class="hljs javascript" data-noescape>
              ~  0b0000000011111111

              == 0b1111111100000000

              <span class="fragment">== -256</span>
            </code></pre></h1>
          </section>


          <section id="bit-shift">
            <h1 class="head-up"> <<,  >> (Bit shifting)</h1>

            <h1><pre><code data-trim class="hljs javascript" data-noescape>
                 0b0000000011111111

              <span class="_operator">>> 4</span>

              == 0b<span class="_value">0000000000001111</span>
            </code></pre></h1>
          </section>


          <section>
            <h1>In use</h1>
          </section>

          <section>
            <h3><pre><code data-trim class="hljs javascript" data-noescape>
              const FLAG_1 = 0b0001
              const FLAG_2 = 0b0010
              const FLAG_3 = 0b0100
              const FLAG_4 = 0b1000


              const v = FLAG_1 | FLAG_4


              if(v &amp; FLAG_1) …
              if(v &amp; FLAG_1 &amp;&amp; v &amp; FLAG_3) …

            </code></pre></h3>
          </section>

          <section>
            <h3><pre><code data-trim class="hljs javascript" data-noescape>
              const floor = 3.145|0


              if(~str.indexOf(word)) {
                // doesn't contain word
              }
            </code></pre></h3>
          </section>

          <section>
            <h3>Implementing functions</h3>
            <h2>
              <pre><code>hex_to_rgb('#abcdef') == 'rgb(11, 205, 239)'</code></pre>
            </h2>
          </section>

          <!-- <section>

            <h2><pre class="stretch"><code data-trim class="hljs javascript" data-noescape>
              const colour = parseInt('bada55', 16)
              // [r     ][g     ][b     ]
              // 101110101101101001010101
              const blue  = colour &amp; 0xff
              // 01010101 (85)
              const green = colour >> 8 &amp; 0xff
              // 11011010 (218)
              const red   = colour >> 16
              // 10111010 (186)
              `rgb(${red}, ${green}, ${blue})`
              // rgb(186, 218, 85)
            </code></pre></h2>
          </section>

           -->

           <section>

             <h3><pre class="stretch"><code data-trim class="hljs javascript" data-noescape>
              // '#abcdef'

              <span class="fragment">const from_hex =
                s => parseInt(s.slice(1), 16)</span>

              <span class="fragment">const to_rgb =
                c => `rgb(${c>>16}, ${c>>8&amp;255}, ${c&amp;255})`</span>

              <span class="fragment">const hex_to_rgb =
                h => to_rgb(from_hex(h))</span>
             </code></pre></h3>

             <p style="text-align:right" class="fragment">*</p>
           </section>

           <section>
             <h6><small>* it's not always <em>quite</em> that simple</small></h6>
           </section>

           <section>
             <h1>/</h1>
             <h2>Bits</h2>
             <h2>Numbers</h2>
             <h2>Binary operators</h2>
           </section>
        </section>

        <section>
          <section data-background="#fff">
            <h1>Handling bigger things</h1>
          </section>
          <section>
            <!-- <h1>Longer than a number?</h1> -->
            <p class="mono">
              00010101010101010101010101010101010100001010101010
              10101010101010101010101000010101010101010101010101
              01010101010000101010101010101010101010101010101000
              01010101010101010101010101010101010000101010101010
              10101010101010101010101000010101010101010101010101
              01010101010000101010101010101010101010101010101000
              01010101010101010101010102<!-- lol -->010101010000101010101010
              10101010101010101010101000010101010101010101010101
              01010101010000101010101010101010101010101010101000
              01010101010101010101010101010101010000101010101010
              01010101010101010101010101010101010000101010101010
              10101010101010101010101000010101010101010101010101
              01010101010000101010101010101010101010101010101000
              01010101010101010101010101010101010000101010101010
            </p>
          </section>
          <section>
            <h1>Split it up into numbers</h1>
          </section>
          <section>
            <h3>
              Int8Array,
              Uint8Array,
              Uint8ClampedArray,
              Int16Array,
              Uint16Array,
              Int32Array,
              Uint32Array,
              Float32Array,
              Float64Array
            </h3>
          </section>

          <section>
            <h2>ArrayBuffers</h2>
          </section>

          <section>
            <h4>u8 = new Uint8Array(48)</h4>
            <h4>buffer = u8.buffer</h4>

            <div data-buffer-view="buffer" class="mono"></div>

            <h4>
              todo:
            </h4>
            <ul>
              <li>u8_2 = new Uint8Array(u8.buffer, 6, 6)</li>
              <li>u32 = new Uint32Array(u8.buffer)</li>
              <li>dv = new DataView(buffer)</li>
            </ul>

          </section>

          <section>
            <h1>memory impact</h1>
            <h3>[..]</h3>
          </section>

          <section>
            <h1>Updating multiple elements</h1>
            <h3>[..]</h3>
          </section>

          <section>
            <h1>Buffer backed objects</h1>
            <ul>
              <li>travesing large datasets</li>
              <li>rapidly changing data</li>
              <li>minimising transfer</li>
              <li>constrained memory</li>
              <li>tracking an object through a scene</li>
            </ul>
          </section>

          <section>
            <h1>Serialisation &amp; transfer</h1>
            <h2>protobuffers</h2>
            <h2>flatbuffers</h2>
          </section>

          <section>
            <h1>/</h1>
            <h2>Array Buffers</h2>
            <h2>Typed Arrays</h2>
            <h2>DataViews</h2>
          </section>
        </section>

        <section>
          <section data-background="#fff">
            <h1>Let's do some stuff</h1>
          </section>
        </section>

        <section>
          <section data-background="#fff">
            <h1>Images</h1>
          </section>
          <section>
            <pre style="margin:0"><code>&lt;img src="joanie.jpg" /&gt;</code></pre>
            <div class="img-row stretch">
              <img src="images/imagedata-joanie.jpg">
            </div>
          </section>

          <section>
            <h3>joanie.jpg &rarr; Raw pixel values</h3>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
              const {width, height} = image_element

              const canvas = document.createElement('canvas')
              canvas.width = width
              canvas.height = height

              const ctx = canvas.getContext('2d')

              ctx.drawImage(image_element, 0, 0, width, height)

              const imageData = ctx.getImageData(0, 0, width, height)
            </code></pre>
          </section>

          <section>
            <h3><pre style="margin:0"><code data-trim class="hljs javascript">
              {
                width: 500,
                height: 500,
                data: [ r, g, b, a, … ] // 1M
              }
            </code></pre></h3>
          </section>

          <section>
            <h1>[00101010101010101]</h1>
          </section>

          <section>
            <pre style="margin:0"><code data-trim>
              ctx.putImageData(imageData, 0, 0)
            </code></pre>
          </section>

          <section class="image-data-code">
            <div class="img-row stretch">
              <img src="images/imagedata-joanie.jpg">
              <pre style="margin:.5em"><code data-trim contenteditable class="hljs javascript">
                const {data} = imageData

                for(let i = 0; i < data.length; i += 4) {
                  data[i] = 0
                }

                ctx.putImageData(imageData, 0, 0)
              </code></pre>
            </div>
          </section>

          <section class="image-data-code">
            <div class="img-row stretch">
              <img src="images/imagedata-joanie.jpg">
              <pre style="margin:.5em"><code data-trim contenteditable class="hljs javascript">
                const data = new Uint32Array(
                  imageData.data.buffer
                )

                const r = 0x000000ff
                const g = 0x0000ff00
                const b = 0x00ff0000
                const a = 0xff000000


                for(let i = 0; i < data.length; i++) {
                  data[i] = data[i] & r | a
                }

                // data.fill(0xffcc00ff)

                // const m = 0xff
                //data.sort((a, b) => (a & m) - (b & m) )


                ctx.putImageData(imageData, 0, 0)
              </code></pre>
            </div>
          </section>

          <section>
            <h1>/</h1>
            <h2>Images</h2>
            <h3>Canvas2D, ImageData</h3>
          </section>

        </section>


        <section>
          <section data-background="#fff">
            <h1>Audio</h1>
          </section>
          <section>
            <pre style="margin:0"><code>&lt;audio src="bach.ogg" controls /&gt;</code></pre>
            <div class="img-row stretch">
              <audio src="assets/bach.ogg" controls>
            </div>
          </section>
          <section>
            <h3>bach.ogg &rarr; Raw audio data</h3>
          </section>
          <section>
            <h1>Web Audio</h1>
            <h3>Graph</h3>
          </section>
          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
              const ctx = new AudioContext()

              const source = ctx.createMediaElementSource(audio_element)
              const analyser = audioCtx.createAnalyser()

              source.connect(analyser)
              analyser.connect(ctx.destination)
            </code></pre>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">

              const timeData = new Uint8Array(analyser.fftSize)
              analyser.getByteTimeDomainData(timeData)

              var freqData = new Uint8Array(analyser.frequencyBinCount)
              analyser.getByteFrequencyData(freqData)

            </code></pre>
          </section>

          <section id="audio-time-data">
            <h2>Time Domain Data</h2>
            <p><audio src="assets/bach.ogg" controls ></audio></p>
            <p class="mono output">[]</p>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
              const ctx = canvas.getContext('2d')
              ctx.scale(canvas.width / timeData.length, canvas.height / 255)

              const draw = () => {
                requestAnimationFrame(draw)

                analyser.getByteTimeDomainData(timeData)


                ctx.clearRect(0,0,timeData.length,255)

                ctx.beginPath()
                timeData.forEach((value, i) => {
                  ctx.lineTo(i, value)
                })
                ctx.stroke()
              }
              draw()
            </code></pre>
          </section>

          <section id="audio-time-graph">
            <h2>Time Domain Data</h2>
            <p><audio src="assets/bach.ogg" controls ></audio></p>

            <canvas width=1280 height=300></canvas>
          </section>

          <section id="audio-freq-data">
            <h2>Frequency Data</h2>
            <p><audio src="assets/bach.ogg" controls ></audio></p>
            <p class="mono output">[]</p>
          </section>

          <section id="audio-freq-graph">
            <h2>Frequency Data</h2>
            <p><audio src="assets/bach.ogg" controls ></audio></p>

            <canvas width=1280 height=300></canvas>
          </section>


          <section>
            <h1>Generating Audio</h1>
          </section>

          <section>
            <h1>BufferSourceNode</h1>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
            const ctx = new AudioContext()

            const audio_buffer = ctx.createBuffer(
              1, ctx.sampleRate, ctx.sampleRate
            )

            const channel_data = audio_buffer.getChannelData(0) // Float32Array!
            </code></pre>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
            for(let t in channel_data)
              channel_data[t] = -1…1
            </code></pre>
          </section>

          <section>
            <pre style="margin:0"><code data-trim class="hljs javascript">
            const source = ctx.createBufferSource()
            source.buffer = audio_buffer
            source.connect(ctx.destination)
            source.start()
            </code></pre>
          </section>


          <section class="audio-data-code">
            <h2><pre style="margin:0"><code data-trim class="hljs javascript" contenteditable>
              for(let t in channel_data)
                channel_data[t] = Math.random()*2 -1
            </code></pre></h2>
            <p>
              <button>&rarr;</button>
            </p>
          </section>



        </section>


        <section>
          <section data-background="#fff">
            <h1>Mixing stuff together</h1>
          </section>
        </section>

        <section>
          <section data-background="#fff">
            <h1>Audio FFT &rarr; ImageData?</h1>
          </section>

          <section>
            <p class="mono">[f, f, f, f, f, f, f, f, …]</p>
            <p class="mono">[r, g, b, a, r, g, b, a, …]</p>
          </section>

          <section>
            <h1>Not a perfect fit, but whatever</h1>
          </section>

          <section id="audio-spectrograph">
            <p><audio src="assets/bach.ogg" controls ></audio></p>
            <canvas width=256 height=1280 style="transform:rotate(-90deg) translate(350px, 0) scale(2.5,1)"></canvas>
          </section>

          <section>
            <h1>Colour mapping</h1>
          </section>

          <section id="audio-spectrograph-color">
            <p><audio src="assets/bach.ogg" controls ></audio></p>
            <canvas width=256 height=1280 style="transform:rotate(-90deg) translate(350px, 0) scale(2.5,1)"></canvas>
          </section>

        </section>


        <section>
          <section data-background="#fff">
            <h1>Remote Data</h1>
          </section>

          <section>
            <p>[nexmo]</p>
          </section>

        </section>



      </div>
    </div>

    <script src="lib/reveal.js/lib/js/head.min.js"></script>
    <script src="lib/reveal.js/js/reveal.js"></script>
    <script src="lib/slide-builder/slide-builder.js"></script>

    <script src="lib/@tweenjs/tween.js/src/Tween.js"></script>

    <script>

      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        // margin: 0,
        width: 1280,
        height: 720,

        transition: 'slide',

        dependencies: [
          {
            src: 'lib/reveal.js/plugin/highlight/highlight.js',
            callback: function() { hljs.initHighlightingOnLoad() }
          },

          {src: 'scripts/bufferView.js'},

          // {
          //  src: 'scripts/CountDecimal.js',
          //    callback: () => {
          //      new CountDecimal('#count-dec')
          //    }
          //  },

          {
            src: 'scripts/BitShift.js',
            callback: () => {
              setTimeout(() =>{
                new BitShift('#bit-shift')
              }, 100)

            }
          },

          {
            src: 'scripts/imageDataCode.js',
            callback: () => {
              for(let slide of document.querySelectorAll('.image-data-code')) {
                new ImageDataCode(slide)
              }
            }
          },

          {
            src: 'scripts/audioDataCode.js',
            callback: () => {
              for(let slide of document.querySelectorAll('.audio-data-code')) {
                new AudioDataCode(slide)
              }
            }
          },



          {
            src: 'scripts/web-audio.js'
          }


        ]
      })

    </script>

  </body>
</html>
